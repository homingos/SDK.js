{"version":3,"file":"FlamSaasSDK.min.esm.js","sources":["../src/constants.js","../src/renderWithRetry.js","../src/helper/assert.js","../src/sdk.js","../src/placeOrder.js","../src/receiveMessage.js","../src/sendMessage.js","../src/closeIFrame.js","../src/version.js","../src/index.js"],"sourcesContent":["// const SDK_BASE_URL = 'https://saas-sdk-flam.vercel.app';\nconst SDK_BASE_URL = 'http://localhost:3000';\n\nexport const PAGES = {\n  main: SDK_BASE_URL,\n  error: `${SDK_BASE_URL}/error`\n};\n","import { PAGES } from './constants';\n\nexport let trackOrder = null;\n\n/**\n * Renders the UI for Placing Order\n * @function\n * @param {String} url url to either order flow or error page\n */\n\nexport default async function renderWithRetry(url) {\n  const body = document.querySelector('body');\n\n  const styleSheet = document.createElement('style');\n  styleSheet.type = 'text/css';\n  styleSheet.id = 'saas-sdk-style';\n  styleSheet.innerText = `\n    body {\n      overflow: hidden;\n    }\n\n    .flam-sdk-loading-wrapper {\n      position: fixed;\n      top: 0;\n      right: 0;\n      bottom: 0;\n      left: 0;\n\n      min-height: 100vh;\n      min-width: 100vw;\n      overflow: hidden;\n      border: none;\n      background: rgba(0,0,0, 0.4);\n\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n\n    #flam-sdk-iframe {\n      position: fixed;\n      top: 0;\n      right: 0;\n      bottom: 0;\n      left: 0;\n\n      min-height: 100vh;\n      min-width: 100vw;\n      border: none;\n    }\n\n    .flam-sdk-loading {\n      position: relative;\n      width: 80px;\n      height: 80px;\n    }\n\n    .flam-sdk-loading div {\n      box-sizing: border-box;\n      display: block;\n      position: absolute;\n      width: 64px;\n      height: 64px;\n      margin: 8px;\n      border: 3px solid #000;\n      border-radius: 50%;\n      animation: flam-sdk-loading 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;\n      border-color: #000 transparent transparent transparent;\n    }\n    .flam-sdk-loading div:nth-child(1) {\n      animation-delay: -0.45s;\n    }\n    .flam-sdk-loading div:nth-child(2) {\n      animation-delay: -0.3s;\n    }\n    .flam-sdk-loading div:nth-child(3) {\n      animation-delay: -0.15s;\n    }\n    @keyframes flam-sdk-loading {\n      0% {\n        transform: rotate(0deg);\n      }\n      100% {\n        transform: rotate(360deg);\n      }\n    }\n  `;\n\n  document.head.appendChild(styleSheet);\n\n  const UI = document.createElement('div');\n  UI.id = 'flam-sdk-wrapper';\n\n  var RegExp = /(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i;\n\n  const newUrl = () => {\n    if (\n      this.order_details &&\n      this.order_details.theme &&\n      this.order_details.theme.color &&\n      RegExp.test(this.order_details.theme.color)\n    ) {\n      const x = '/?theme=';\n      return url + x + encodeURIComponent(this.order_details.theme.color);\n    }\n    return url;\n  };\n\n  UI.innerHTML = `\n      <div class=\"flam-sdk-loading-wrapper\" id=\"flam-sdk-loading-wrapper\">\n        <div class=\"flam-sdk-loading\" id=\"flam-sdk-loading\"><div></div><div></div><div></div><div></div></div>\n      </div>\n      <iframe id=\"flam-sdk-iframe\" style=\"opacity: 0\" name=\"flam-sdk-iframe\" src=\"${newUrl()}\" style=\"opacity: 0\"></iframe>      \n    `;\n\n  body.appendChild(UI);\n\n  const iFrame = document.getElementById('flam-sdk-iframe');\n\n  iFrame.addEventListener('load', async e => {\n    e.preventDefault();\n\n    try {\n      // check if website available in PRODUCTION\n      if (this.clientData.environment == 'PRODUCTION') {\n        await fetch(PAGES.main);\n      }\n\n      // hide initial loading\n      document.getElementById('flam-sdk-loading-wrapper').style.display =\n        'none';\n\n      // Show the iframe content\n      iFrame.style.opacity = '1';\n\n      // message event handler\n      trackOrder = e => {\n        this.receiveMessage(e);\n      };\n\n      // event listener for receiving messages from iframe\n      window.addEventListener('message', trackOrder);\n\n      // save window context for sending messages to iframe\n      this.iWindow = document.getElementById('flam-sdk-iframe').contentWindow;\n    } catch (err) {\n      if (err.message === 'Failed to fetch') {\n        this.close();\n        this.callback({\n          code: 500,\n          message: 'Unable to acess SDK Website!'\n        });\n        return;\n      }\n      this.callback({\n        code: 500,\n        message: 'Something went wrong!'\n      });\n    }\n  });\n}\n","var toString = Object.prototype.toString;\n\nfunction attribute(o, attr, type, text) {\n    type = type === 'array' ? 'object' : type;\n    if (o && typeof o[attr] !== type) {\n        throw new Error(text);\n    }\n}\n\nfunction variable(o, type, text) {\n    if (typeof o !== type) {\n        throw new Error(text);\n    }\n}\n\nfunction value(o, values, text) {\n    if (values.indexOf(o) === -1) {\n        throw new Error(text);\n    }\n}\n\nfunction check(o, config, attributes) {\n    if (!config.optional || o) {\n        variable(o, config.type, config.message);\n    }\n    if (config.type === 'object' && attributes) {\n        var keys = Object.keys(attributes);\n\n        for (var index = 0; index < keys.length; index++) {\n            var a = keys[index];\n            if (!attributes[a].optional || o[a]) {\n                if (!attributes[a].condition || attributes[a].condition(o)) {\n                    attribute(o, a, attributes[a].type, attributes[a].message);\n                    if (attributes[a].values) {\n                        value(o[a], attributes[a].values, attributes[a].value_message);\n                    }\n                }\n            }\n        }\n    }\n}\n\n/**\n * Wrap `Array.isArray` Polyfill for IE9\n * source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray\n *\n * @param {Array} array\n * @private\n */\nfunction isArray(array) {\n    if (this.supportsIsArray()) {\n        return Array.isArray(array);\n    }\n\n    return toString.call(array) === '[object Array]';\n}\n\nfunction supportsIsArray() {\n    return Array.isArray != null;\n}\n\nexport default {\n    check: check,\n    attribute: attribute,\n    variable: variable,\n    value: value,\n    isArray: isArray,\n    supportsIsArray: supportsIsArray\n};","import closeIframe from './closeIFrame';\nimport assert from './helper/assert';\nimport placeOrder from './placeOrder';\nimport receiveMessage from './receiveMessage';\nimport renderWithRetry from './renderWithRetry';\nimport sendMessage from './sendMessage';\n\n/**\n * Initializes a SDK instance\n * @constructor\n * @param {Object} options\n * @param {String} options.key the API Key found on your Application settings page\n * @param {String} [options.environment] enviornment SANDBOX | PRODUCTION\n */\nfunction init(options) {\n  /* eslint-disable */\n\n  // validate the client's input for 'init'\n  try {\n    assert.check(\n      options,\n      { type: 'object', message: 'init parameter is not valid.' },\n      {\n        key: { type: 'string', message: \"'key' is required string.\" },\n        environment: {\n          optional: true,\n          type: 'string',\n          message: \"'environment' must be string.\"\n        }\n      }\n    );\n  } catch (err) {\n    // assert method above throws error with given message which we further throw to client.\n    if (err && err.message) {\n      throw err.message;\n    }\n    throw 'Something went wrong!';\n  }\n\n  // set environment to 'PRODUCTION' if stated by client, otherwise 'SANDBOX'\n  options.environment =\n    options &&\n    typeof options.environment === 'string' &&\n    options.environment.toUpperCase() === 'PRODUCTION'\n      ? 'PRODUCTION'\n      : 'SANDBOX';\n\n  // save options to clientData\n  this.clientData = options;\n\n  /* eslint-enable */\n}\n\n// core methods\ninit.prototype.renderWithRetry = renderWithRetry;\ninit.prototype.placeOrder = placeOrder;\ninit.prototype.receiveMessage = receiveMessage;\ninit.prototype.sendMessage = sendMessage;\ninit.prototype.close = closeIframe;\n\nexport default init;\n","import { PAGES } from './constants';\nimport assert from './helper/assert';\n\n/**\n * Runs the SDK for Placing Order\n * @function\n * @param {Object} options\n * @param {String} options.key the API Key found on your Application settings page\n * @param {String} [options.environment] enviornment sandbox | production\n */\n\n// TODO: write the parameter descriptions\n\nexport default async function placeOrder(order_details, callback) {\n  try {\n    // validate client data\n    assert.check(\n      this.clientData,\n      { type: 'object', message: 'init data is invalid' },\n      {\n        key: { type: 'string', message: \"'key' is required string.\" },\n        environment: {\n          optional: true,\n          type: 'string',\n          message: \"'environment' must be string.\"\n        }\n      }\n    );\n\n    // validate order_details\n    assert.check(\n      order_details,\n      {\n        type: 'object',\n        message: \"'order_details' is not valid.\"\n      },\n      {\n        productId: {\n          type: 'string',\n          message: \"'productId' is required string.\"\n        },\n        refId: { type: 'string', message: \"'refId' is required string.\" },\n        photo: {\n          optional: true,\n          type: 'string',\n          message: \"'photo' must be string.\"\n        },\n        video: {\n          optional: true,\n          type: 'string',\n          message: \"'video' must be string.\"\n        },\n        prefill: {\n          optional: true,\n          type: 'object',\n          message: \"'prefill' must be object.\"\n        },\n        animation: {\n          optional: true,\n          type: 'string',\n          message: \"'animation' must be string.\"\n        },\n        theme: {\n          optional: true,\n          type: 'object',\n          message: \"'theme' must be object.\"\n        },\n        logo: {\n          optional: true,\n          type: 'object',\n          message: \"'logo' must be string.\"\n        }\n      }\n    );\n\n    // validate callback function\n    assert.check(callback, {\n      type: 'function',\n      message: \"'callback' is required function.\"\n    });\n\n    // save order_details\n    this.order_details = order_details;\n\n    // render the success UI\n    let url = `${PAGES.main}`;\n    this.callback = callback;\n    await this.renderWithRetry(url);\n  } catch (err) {\n    if (callback && typeof callback === 'function') {\n      // render error UI\n      let url = `${PAGES.error}/Something went wrong!`;\n      await this.renderWithRetry(url);\n      // callback to client with error\n      await callback({ code: 400, message: err.message }, null);\n    } else {\n      throw \"'callback' is required function.\";\n    }\n  }\n  document.activeElement.blur();\n}\n","import { PAGES } from './constants';\n\nexport default function receiveMessage(event) {\n  if (event.origin == PAGES.main) {\n    switch (event.data.type) {\n      case 'CLOSE':\n        this.close();\n        break;\n      case 'READY_TO_RECEIVE':\n        this.sendMessage({\n          type: 'INITIAL_DATA',\n          payload: {\n            client_data: this.clientData,\n            order_details: this.order_details\n          }\n        });\n        break;\n      case 'READY_TO_RECEIVE_ERR':\n        this.sendMessage({\n          type: 'INITIAL_DATA_ERR',\n          payload: {\n            email:\n              this.order_details &&\n              this.order_details.prefill &&\n              this.order_details.prefill.email\n                ? this.order_details.prefill.email\n                : '',\n            phone:\n              this.order_details &&\n              this.order_details.prefill &&\n              this.order_details.prefill.phone\n                ? this.order_details.prefill.phone\n                : ''\n          }\n        });\n        break;\n      case 'CREATED':\n        this.callback(null, {\n          code: 201,\n          data: event.data.payload,\n          message: 'Order placed successfully!'\n        });\n        this.close();\n        break;\n      case 'ERROR':\n        this.callback(\n          {\n            code: event.data.payload.code,\n            message: event.data.payload.message\n          },\n          null\n        );\n        break;\n    }\n  }\n}\n","import { PAGES } from './constants';\n\nexport default function sendMessage(message) {\n  this.iWindow.postMessage(message, PAGES.main);\n}\n","import { trackOrder } from './renderWithRetry';\n\nexport default function close() {\n  window.removeEventListener('message', trackOrder);\n\n  // remove the UI\n  const element = document.getElementById('flam-sdk-wrapper');\n  if (element) {\n    element.remove();\n  }\n\n  // remove the styles\n  const styleSheet = document.getElementById('saas-sdk-style');\n\n  if (styleSheet) {\n    styleSheet.remove();\n  }\n}\n","module.exports = { raw: '1.0.0' };","import init from './sdk';\nimport version from './version';\n\nexport { version, init };\n\nexport default { version: version, init: init };\n"],"names":["PAGES","trackOrder","toString","Object","prototype","attribute","o","attr","type","text","Error","variable","value","values","indexOf","check","config","attributes","optional","message","keys","index","length","a","condition","value_message","isArray","array","this","supportsIsArray","Array","call","init","options","assert","key","environment","err","toUpperCase","clientData","renderWithRetry","async","url","body","document","querySelector","styleSheet","createElement","id","innerText","head","appendChild","UI","RegExp","innerHTML","order_details","theme","color","test","encodeURIComponent","newUrl","iFrame","getElementById","addEventListener","e","preventDefault","fetch","style","display","opacity","receiveMessage","window","iWindow","contentWindow","close","callback","code","placeOrder","productId","refId","photo","video","prefill","animation","logo","activeElement","blur","event","origin","data","sendMessage","payload","client_data","email","phone","postMessage","removeEventListener","element","remove","raw","version"],"mappings":"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"}
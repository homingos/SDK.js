/**
 * flamsdk v1.0.3
 * Author: bucharitesh
 * Date: 2022-09-25
 * License: MIT
 */

const PAGES_main="https://saas-sdk-flam.vercel.app",PAGES_error="https://saas-sdk-flam.vercel.app/error";let trackOrder=null;var toString=Object.prototype.toString;function attribute(o,attr,type,text){if(type="array"===type?"object":type,o&&typeof o[attr]!==type)throw new Error(text)}function variable(o,type,text){if(typeof o!==type)throw new Error(text)}function value(o,values,text){if(-1===values.indexOf(o))throw new Error(text)}var assert={check:function(o,config,attributes){if(config.optional&&!o||variable(o,config.type,config.message),"object"===config.type&&attributes)for(var keys=Object.keys(attributes),index=0;index<keys.length;index++){var a=keys[index];attributes[a].optional&&!o[a]||attributes[a].condition&&!attributes[a].condition(o)||(attribute(o,a,attributes[a].type,attributes[a].message),attributes[a].values&&value(o[a],attributes[a].values,attributes[a].value_message))}},attribute:attribute,variable:variable,value:value,isArray:function(array){return this.supportsIsArray()?Array.isArray(array):"[object Array]"===toString.call(array)},supportsIsArray:function(){return null!=Array.isArray}};function init(options){try{assert.check(options,{type:"object",message:"init parameter is not valid."},{key:{type:"string",message:"'key' is required string."},environment:{optional:!0,type:"string",message:"'environment' must be string."}})}catch(err){if(err&&err.message)throw err.message;throw"Something went wrong!"}options.environment=options&&"string"==typeof options.environment&&"PRODUCTION"===options.environment.toUpperCase()?"PRODUCTION":"SANDBOX",this.clientData=options}init.prototype.renderWithRetry=async function(url){const body=document.querySelector("body"),styleSheet=document.createElement("style");styleSheet.type="text/css",styleSheet.id="saas-sdk-style",styleSheet.innerText="\n    body {\n      overflow: hidden;\n    }\n\n    .flam-sdk-loading-wrapper {\n      position: fixed;\n      top: 0;\n      right: 0;\n      bottom: 0;\n      left: 0;\n\n      min-height: 100vh;\n      min-width: 100vw;\n      overflow: hidden;\n      border: none;\n      background: rgba(0,0,0, 0.4);\n\n      display: flex;\n      justify-content: center;\n      align-items: center;\n\n      z-index: 1000;\n    }\n\n    #flam-sdk-iframe {\n      position: fixed;\n      top: 0;\n      right: 0;\n      bottom: 0;\n      left: 0;\n\n      min-height: 100vh;\n      min-width: 100vw;\n      border: none;\n\n      z-index: 1000;\n    }\n\n    .flam-sdk-loading {\n      position: relative;\n      width: 80px;\n      height: 80px;\n    }\n\n    .flam-sdk-loading div {\n      box-sizing: border-box;\n      display: block;\n      position: absolute;\n      width: 64px;\n      height: 64px;\n      margin: 8px;\n      border: 3px solid #000;\n      border-radius: 50%;\n      animation: flam-sdk-loading 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;\n      border-color: #000 transparent transparent transparent;\n    }\n    .flam-sdk-loading div:nth-child(1) {\n      animation-delay: -0.45s;\n    }\n    .flam-sdk-loading div:nth-child(2) {\n      animation-delay: -0.3s;\n    }\n    .flam-sdk-loading div:nth-child(3) {\n      animation-delay: -0.15s;\n    }\n    @keyframes flam-sdk-loading {\n      0% {\n        transform: rotate(0deg);\n      }\n      100% {\n        transform: rotate(360deg);\n      }\n    }\n  ",document.head.appendChild(styleSheet);const UI=document.createElement("div");UI.id="flam-sdk-wrapper";var RegExp=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i;UI.innerHTML=`\n      <div class="flam-sdk-loading-wrapper" id="flam-sdk-loading-wrapper">\n        <div class="flam-sdk-loading" id="flam-sdk-loading"><div></div><div></div><div></div><div></div></div>\n      </div>\n      <iframe id="flam-sdk-iframe" style="opacity: 0" name="flam-sdk-iframe" src="${(()=>{if(this.order_details&&this.order_details.theme&&this.order_details.theme.color&&RegExp.test(this.order_details.theme.color)){return url+"/?theme="+encodeURIComponent(this.order_details.theme.color)}return url})()}" style="opacity: 0"></iframe>      \n    `,body.appendChild(UI);const iFrame=document.getElementById("flam-sdk-iframe");iFrame.addEventListener("load",(async e=>{e.preventDefault();try{"PRODUCTION"==this.clientData.environment&&await fetch(PAGES_main),document.getElementById("flam-sdk-loading-wrapper").style.display="none",iFrame.style.opacity="1",trackOrder=e=>{this.receiveMessage(e)},window.addEventListener("message",trackOrder),this.iWindow=document.getElementById("flam-sdk-iframe").contentWindow}catch(err){if("Failed to fetch"===err.message)return this.close(),void this.callback({code:500,message:"Unable to acess SDK Website!"});this.callback({code:500,message:"Something went wrong!"})}}))},init.prototype.placeOrder=async function(order_details,callback){try{assert.check(this.clientData,{type:"object",message:"init data is invalid"},{key:{type:"string",message:"'key' is required string."},environment:{optional:!0,type:"string",message:"'environment' must be string."}}),assert.check(order_details,{type:"object",message:"'order details' is not valid."},{productId:{type:"string",message:"'productId' is required string."},refId:{type:"string",message:"'refId' is required string."},photo:{optional:!0,type:"string",message:"'photo' must be string."},video:{optional:!0,type:"string",message:"'video' must be string."},prefill:{optional:!0,type:"object",message:"'prefill' must be object."},animation:{optional:!0,type:"string",message:"'animation' must be string."},theme:{optional:!0,type:"object",message:"'theme' must be object."},logo:{optional:!0,type:"string",message:"'logo' must be string."}}),order_details.prefill&&assert.check(order_details.prefill,{type:"object",message:"'prefill' is not valid."},{name:{optional:!0,type:"string",message:"'name' is required string."},email:{optional:!0,type:"string",message:"'email' is required string."},phone:{optional:!0,type:"string",message:"'phone' must be string."}}),order_details.theme&&assert.check(order_details.theme,{type:"object",message:"'theme' is not valid."},{color:{optional:!0,type:"string",message:"'name' is required string."}}),assert.check(callback,{type:"function",message:"'callback' is required function."}),this.order_details=order_details;let url=`${PAGES_main}`;this.callback=callback,await this.renderWithRetry(url)}catch(err){if(!callback||"function"!=typeof callback)throw"'callback' is required function.";{let url=`${PAGES_error}/Something went wrong!`;await this.renderWithRetry(url),await callback({code:400,message:err.message},null)}}document.activeElement.blur()},init.prototype.receiveMessage=function(event){if(event.origin==PAGES_main)switch(event.data.type){case"CLOSE":this.close();break;case"READY_TO_RECEIVE":this.sendMessage({type:"INITIAL_DATA",payload:{client_data:this.clientData,order_details:this.order_details}});break;case"READY_TO_RECEIVE_ERR":this.sendMessage({type:"INITIAL_DATA_ERR",payload:{...this.clientData,email:this.order_details&&this.order_details.prefill&&this.order_details.prefill.email?this.order_details.prefill.email:"",phone:this.order_details&&this.order_details.prefill&&this.order_details.prefill.phone?this.order_details.prefill.phone:""}});break;case"CREATED":this.callback(null,{code:201,data:event.data.payload,message:"Order placed successfully!"}),this.close();break;case"ERROR":this.callback({code:event.data.payload.code,message:event.data.payload.message},null)}},init.prototype.sendMessage=function(message){this.iWindow.postMessage(message,PAGES_main)},init.prototype.close=function(){window.removeEventListener("message",trackOrder);const element=document.getElementById("flam-sdk-wrapper");element&&element.remove();const styleSheet=document.getElementById("saas-sdk-style");styleSheet&&styleSheet.remove()};var version={raw:"1.0.3"},index={version:version,init:init};export{index as default,init,version};
//# sourceMappingURL=FlamSaasSDK.min.esm.js.map

{"version":3,"file":"flamSdk.min.js","sources":["../src/helper/assert.js","../src/constants.js","../src/sdk.js","../src/renderWithRetry.js","../src/placeOrder.js","../src/receiveMessage.js","../src/sendMessage.js","../src/closeIFrame.js","../src/version.js","../src/index.js"],"sourcesContent":["var toString = Object.prototype.toString;\n\nfunction attribute(o, attr, type, text) {\n    type = type === 'array' ? 'object' : type;\n    if (o && typeof o[attr] !== type) {\n        throw new Error(text);\n    }\n}\n\nfunction variable(o, type, text) {\n    if (typeof o !== type) {\n        throw new Error(text);\n    }\n}\n\nfunction value(o, values, text) {\n    if (values.indexOf(o) === -1) {\n        throw new Error(text);\n    }\n}\n\nfunction check(o, config, attributes) {\n    if (!config.optional || o) {\n        variable(o, config.type, config.message);\n    }\n    if (config.type === 'object' && attributes) {\n        var keys = Object.keys(attributes);\n\n        for (var index = 0; index < keys.length; index++) {\n            var a = keys[index];\n            if (!attributes[a].optional || o[a]) {\n                if (!attributes[a].condition || attributes[a].condition(o)) {\n                    attribute(o, a, attributes[a].type, attributes[a].message);\n                    if (attributes[a].values) {\n                        value(o[a], attributes[a].values, attributes[a].value_message);\n                    }\n                }\n            }\n        }\n    }\n}\n\n/**\n * Wrap `Array.isArray` Polyfill for IE9\n * source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray\n *\n * @param {Array} array\n * @private\n */\nfunction isArray(array) {\n    if (this.supportsIsArray()) {\n        return Array.isArray(array);\n    }\n\n    return toString.call(array) === '[object Array]';\n}\n\nfunction supportsIsArray() {\n    return Array.isArray != null;\n}\n\nexport default {\n    check: check,\n    attribute: attribute,\n    variable: variable,\n    value: value,\n    isArray: isArray,\n    supportsIsArray: supportsIsArray\n};","const SDK_BASE_URL = 'http://localhost:3000';\n\nexport const PAGES = {\n  main: SDK_BASE_URL,\n  error: `${SDK_BASE_URL}/error`\n};\n","import closeIframe from './closeIFrame';\nimport assert from './helper/assert';\nimport placeOrder from './placeOrder';\nimport receiveMessage from './receiveMessage';\nimport renderWithRetry from './renderWithRetry';\nimport sendMessage from './sendMessage';\n\n/**\n * Handles all the browser's AuthN/AuthZ flows\n * @constructor\n * @param {Object} options\n * @param {String} options.key the API Key found on your Application settings page\n * @param {String} [options.environment] enviornment sandbox | production\n * @param {String} [options.name] name of client\n * @param {String} [options.logoUrl] client's brand logo url\n * @param {String} [options.email] client's support email for error page\n * @param {String} [options.phone] client's support phone for error page\n */\nfunction init(options) {\n  /* eslint-disable */\n  try {\n    assert.check(\n      options,\n      { type: 'object', message: 'clientData parameter is not valid' },\n      {\n        key: { type: 'string', message: 'key is required' },\n        environment: {\n          type: 'string',\n          message: 'environment is required'\n        }\n        // name: { type: 'string', message: 'name is required' },\n        // logoUrl: { type: 'string', message: 'logoUrl is required' },\n        // email: { type: 'string', message: 'email is required' },\n        // phone: { type: 'string', message: 'phone is required' }\n      }\n    );\n\n    if (options.overrides) {\n      assert.check(options.overrides, {\n        type: 'object',\n        message: 'overrides option is not valid'\n      });\n    }\n  } catch (err) {\n    throw new Error(err.message);\n  }\n  /* eslint-enable */\n  this.clientData = options;\n  /* eslint-enable */\n}\n\n// core methods\ninit.prototype.renderWithRetry = renderWithRetry;\ninit.prototype.placeOrder = placeOrder;\ninit.prototype.receiveMessage = receiveMessage;\ninit.prototype.sendMessage = sendMessage;\ninit.prototype.close = closeIframe;\n\nexport default init;\n","import { PAGES } from './constants';\n\nexport default async function renderWithRetry({ url, error }) {\n  const body = document.querySelector('body');\n\n  const styleSheet = document.createElement('style');\n  styleSheet.type = 'text/css';\n  styleSheet.id = 'saas-sdk-style';\n  styleSheet.innerText = `\n    .flam-sdk-bg {\n      position: fixed;\n      top: 0;\n      right: 0;\n      bottom: 0;\n      left: 0;\n\n      min-height: 100vh;\n      min-width: 100vw;\n      border: none;\n      background: rgba(0,0,0, 0.4);\n\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n\n    #flam-sdk-iframe {\n      position: fixed;\n      top: 0;\n      right: 0;\n      bottom: 0;\n      left: 0;\n\n      min-height: 100vh;\n      min-width: 100vw;\n      border: none;\n    }\n\n    .flam-sdk-loading {\n      display: inline-block;\n      position: relative;\n      width: 80px;\n      height: 80px;\n    }\n    .flam-sdk-loading div {\n      box-sizing: border-box;\n      display: block;\n      position: absolute;\n      width: 64px;\n      height: 64px;\n      margin: 8px;\n      border: 3px solid #000;\n      border-radius: 50%;\n      animation: flam-sdk-loading 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;\n      border-color: #000 transparent transparent transparent;\n    }\n    .flam-sdk-loading div:nth-child(1) {\n      animation-delay: -0.45s;\n    }\n    .flam-sdk-loading div:nth-child(2) {\n      animation-delay: -0.3s;\n    }\n    .flam-sdk-loading div:nth-child(3) {\n      animation-delay: -0.15s;\n    }\n    @keyframes flam-sdk-loading {\n      0% {\n        transform: rotate(0deg);\n      }\n      100% {\n        transform: rotate(360deg);\n      }\n    }\n  `;\n\n  await document.head.appendChild(styleSheet);\n\n  const UI = await document.createElement('div');\n  UI.innerHTML = `\n      <div class=\"flam-sdk-ui\" id=\"flam-sdk-ui\">\n        <div class=\"flam-sdk-bg\" id=\"flam-sdk-bg\">\n          <div class=\"flam-sdk-loading\" id=\"flam-sdk-loading\"><div></div><div></div><div></div><div></div></div>\n        </div>\n        <iframe id=\"flam-sdk-iframe\" style=\"opacity: 0\" name=\"flam-sdk-iframe\" src=\"${url}\" style=\"opacity: 0\"></iframe>\n      </div>\n    `;\n\n  await body.appendChild(UI);\n\n  const iFrame = document.getElementById('flam-sdk-iframe');\n\n  // iFrame.contentWindow.addEventListener('error', e => {\n  //   console.log('Iframe Error', e);\n  // });\n\n  iFrame.addEventListener('load', async e => {\n    e.preventDefault();\n    // console.log('Iframe Load', e);\n\n    try {\n      if (this.clientData.environment == 'production') {\n        await fetch(PAGES.main);\n      }\n\n      // hide loading\n      document.getElementById('flam-sdk-bg').style.display = 'none';\n\n      // Bring the iframe back\n      iFrame.style.opacity = '1';\n\n      // for receiving messages from iframe\n      window.addEventListener('message', e => this.receiveMessage(e));\n\n      // for sending messages to iframe\n      this.iWindow = document.getElementById('flam-sdk-iframe').contentWindow;\n    } catch (err) {\n      if (err.message === 'Failed to fetch') {\n        this.close();\n        this.callback({\n          code: 500,\n          message: 'SDK down!'\n        });\n      }\n    }\n  });\n}\n","import { PAGES } from './constants';\nimport assert from './helper/assert';\n\nexport default function placeOrder(order_details, callback) {\n  // try {\n  //   assert.check(\n  //     options,\n  //     { type: 'object', message: 'clientData parameter is not valid' },\n  //     {\n  //       key: { type: 'string', message: 'key is required' },\n  //       environment: {\n  //         type: 'string',\n  //         message: 'environment is required'\n  //       }\n  //     }\n  //   );\n  // } catch (err) {}\n\n  this.order_details = order_details;\n\n  if (\n    !this.clientData ||\n    !this.clientData.environment ||\n    !this.clientData.key ||\n    !order_details.productId ||\n    !order_details.refId ||\n    !order_details.animation\n  ) {\n    if (callback) {\n      let url = `${PAGES.error}/Something went wrong!`;\n      this.renderWithRetry({\n        url,\n        error: true\n      });\n      callback({ code: 400, message: 'Insuficiant data!' }, null);\n    } else {\n      throw new Error('callback function is required!');\n    }\n  } else {\n    if (!callback) {\n      throw new Error('callback function is required!');\n    } else {\n      let url = `${PAGES.main}`;\n      // this.product_id = product_id;\n      this.callback = callback;\n      this.renderWithRetry({ url, error: false });\n    }\n  }\n}\n","import { PAGES } from './constants';\n\nexport default function receiveMessage(event) {\n  if (event.origin == PAGES.main) {\n    switch (event.data.type) {\n      case 'CLOSE':\n        this.close();\n        break;\n      case 'READY_TO_RECEIVE':\n        this.sendMessage(\n          {\n            type: 'INITIAL_DATA',\n            payload: {\n              client_data: this.clientData,\n              // product_id: this.product_id,\n              order_details: this.order_details\n            }\n          },\n          '*'\n        );\n        break;\n      case 'READY_TO_RECEIVE_ERR':\n        this.sendMessage(\n          {\n            type: 'INITIAL_DATA_ERR',\n            payload: {\n              email: this.order_details.prefill.name || '',\n              phone: this.order_details.prefill.phone || ''\n            }\n          },\n          '*'\n        );\n        break;\n      case 'CREATED':\n        this.callback(null, {\n          code: 201,\n          data: event.data.payload,\n          message: 'Order placed successfully'\n        });\n        this.close();\n        break;\n      case 'ERROR':\n        this.callback(\n          {\n            code: event.data.payload.code,\n            message: event.data.payload.message\n          },\n          null\n        );\n        // this.close(); // should we close the modal on error ?\n        break;\n    }\n  }\n}\n","export default function sendMessage(message) {\n    this.iWindow.postMessage(message, \"*\")\n};","export default function close() {\n  window.removeEventListener('message', e => this.receiveMessage(e));\n\n  // remove the UI\n  const element = document.getElementById('flam-sdk-ui');\n  if (element) {\n    element.remove();\n  }\n\n  // remove the styles\n  const styleSheet = document.getElementById('saas-sdk-style');\n\n  if (styleSheet) {\n    styleSheet.remove();\n  }\n}\n","module.exports = { raw: '0.0.1' };","import init from './sdk';\nimport version from './version';\n\nexport { version, init };\n\nexport default { version: version, init: init };\n"],"names":["toString","Object","prototype","attribute","o","attr","type","text","Error","variable","value","values","indexOf","check","config","attributes","optional","message","keys","index","length","a","condition","value_message","isArray","array","this","supportsIsArray","Array","call","PAGES","init","options","assert","key","environment","overrides","err","clientData","renderWithRetry","async","url","error","body","document","querySelector","styleSheet","createElement","id","innerText","head","appendChild","UI","innerHTML","iFrame","getElementById","addEventListener","e","preventDefault","fetch","style","display","opacity","window","receiveMessage","iWindow","contentWindow","close","callback","code","placeOrder","order_details","productId","refId","animation","event","origin","data","sendMessage","payload","client_data","email","prefill","name","phone","postMessage","removeEventListener","element","remove","raw","version"],"mappings":"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"}